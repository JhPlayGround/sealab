------------------------------------------------------------------------

이번 튜토리얼에서는 지난 포스팅에 이어 해양저질 표층 퇴적물의 입도조성
자료를 R에서 제공하는 “ggtern” package를 이용해 시각화하는 방법을
설명하고자 한다. 지난 포스팅에서 설명한 “rysgran” package는 내장된
함수들을 통해 퇴적물의 저질분류를 `shepard`, `pejrup`, `flemming`으로
나누고 있으나 이 분류는 현재 우리나라 저질 분류표와 다르다.  
따라서 이번 포스팅에서는 우리나라 저질 분류표를 도시화하고,
[JOISS](https://joiss.kr)에서 제공하고 있는 표층퇴적물 입도조성 자료를
가시화 하였다. 튜토리얼 순서는 아래와 같다.

\[목차\]  
1. R Package “ggtern” 소개 및 설치  
2. R Studio에서 JOISS 표층 퇴적물 입도 자료 불러오기 3. 우리나라 저질
분류표 도시화 3. 삼각 다이어그램 (Ternary Diagram) 그리기

------------------------------------------------------------------------


. R Package “ggtern” 소개 및 설치
=================================

[`ggtern`](https://www.rdocumentation.org/packages/ggtern/versions/2.2.0)는
[‘ggplot2’](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.1)의
기능을 확장하여 ‘ggplot2’ 지오메트리에 대한 3차 다이어그램을 그릴 수있는
기능을 제공하면서 ’ggtern’은 표준 ’ggplot2’에서 사용할 수 없는 몇 가지
새로운 형상을 구현하는 확장판이다.

[`ggtern`](https://www.rdocumentation.org/packages/rysgran/versions/2.1.0)패키지를
설치하고 선언하였다.

``` r
# Download and install a package from CRAN
install.packages("ggtern")
# Load the package into the session making all its functoins available to use
library(ggtern)
```

------------------------------------------------------------------------

. R Studio에서 JOISS 표층 퇴적물 입도 자료 불러오기
===================================================

R과 R Studio 프로그램이 설치되어있지 않은 사용자는 JOISS포털의
[R튜토리얼-R다운로드 및
설치](http://joiss.kr/joiss/cont.tuto.rTutoList.do)를 참고하길 바란다.

본 튜토리얼에서는 예제파일로 JOISS에서 제공하는 표층퇴적물 입도
분석자료를 이용하였다. 해당 자료는 2008년 가로림만에서 수행된 표층
퇴적물 입도 분석자료로 csv로 작성되었으며 자료에 대한 메타데이터 및
QCflag 등이 포함되어 있다.

![](G:\R\Triangular%20diagram\rysgran\rysgran_01_joiss%20data.png)

R Studio에서 예제 파일을 불러오기 위해 `setwd`함수로 예제 파일이 저장된
경로로 설정하였다.

`read.table` 함수로 메타데이터가 포함된 내용은 제거 한 후 변수 “data”에
저장하고, `colnames` 함수로 변수내 항목을 확인하면 해당 예제파일에는
26개의 항목들이 들어있는것을 확인할 수 있다.

``` r
#Change the current working directory
setwd("G:/R/Triangular diagram")
#Load the data into a table using the read.table function
data <- read.table("한국 서해 가로림만 퇴적작용의 특성_2008_profile_geological_unknown.csv", skip = 26, header = TRUE, sep = ",")
View(data)
```

``` r
#Make sure the variable name of the table
colnames(data)
```

    ##  [1] "project_name"             "station"                 
    ##  [3] "yyyy.mm.dd.hh.mm.ss"      "Longitude..degrees_east."
    ##  [5] "Latitude..degrees_south." "bot.depth.m."            
    ##  [7] "깊이.m."                  "깊이.text."              
    ##  [9] "입도.phi."                "mz_qc"                   
    ## [11] "분급도.무단위."           "sd_qc"                   
    ## [13] "왜도.무단위."             "sk_qc"                   
    ## [15] "첨도.무단위."             "k_qc"                    
    ## [17] "Gravel.비율..."           "graper_qc"               
    ## [19] "Sand.비율..."             "sandper_qc"              
    ## [21] "Silt.비율..."             "siltper_qc"              
    ## [23] "Clay.비율..."             "clayper_qc"              
    ## [25] "퇴적물유형.무단위."       "sedtype_qc"

변수 “data”에 저장된 26개의 항목들 중 시각화에 필요한 항목들만
`data.frame` 함수를 사용하여 “data01” 데이터프레임을 생성하고 해당
항목들의 이름을 `colnames` 함수를 이용해 새롭게 매칭하였다.

퇴적물 조성비를 “Gravel\[%\]”, “Sand\[%\]”, “Mud\[%\]”로 가시화 하기
위해 “Silt.비율…”과 “Clay.비율…”의 합을 “Mud\[%\]”로 나타냈다. `View`
함수를 사용하면 새롭게 매칭된 항목을 포함한 “data01”변수를 확인할 수
있다.

``` r
#Create data frame and match the variable name
data01 <- data.frame(data$station, data$yyyy.mm.dd.hh.mm.ss, 
          data$Longitude..degrees_east., data$Latitude..degrees_south, 
          data$Gravel.비율..., data$Sand.비율..., data$Silt.비율..., data$Clay.비율..., 
          data$Silt.비율...+data$Clay.비율..., 
          data$입도.phi., data$분급도.무단위., data$왜도.무단위., data$첨도.무단위.)
colnames(data01)=c("Station", "Time", 
                   "Longitute", "Latitude", 
                   "Gravel[%]", "Sand[%]", "Silt[%]", "Clay[%]", 
                   "Mud[%]",
                   "Mean[Phi]", "Sorting", "Skewness", "Kurtosis")
View(data01)
```

![](G:\R\Triangular%20diagram\rysgran\rysgran_02_data01.png)

------------------------------------------------------------------------

. 삼각 다이어그램 (Ternary Diagram) 그리기
==========================================

퇴적물 조성비를
[rysgran.ternary](https://www.rdocumentation.org/packages/rysgran/versions/2.1.0/topics/rysgran.ternary)
함수로 삼각다이어그램으로 시각화하였다.
[rysgran.ternary](https://www.rdocumentation.org/packages/rysgran/versions/2.1.0/topics/rysgran.ternary)
함수의 ’method’의 옵션은 `shepard`, `pejrup`, `flemming`이 있으며 본
예제에서는 `shepard`를 사용하였다.

``` r
#Plotting of Mud, Sand and Gravel texture(shepard, pejrup, flemming)
rysgran.ternary(x = data01[c(9, 6, 5)], method = "shepard",
                main = "Sed.Textural classifications (Garorim,2008)",
                col = "blue", pch = 20,
                show.grid = TRUE, show.legend = FALSE, 
                show.lines = FALSE, show.names = FALSE)
```

<center>
![rysgran\_04\_diagra](G:\R\Triangular%20diagram\rysgran\rysgran_03_diagram.png "fig:")
</center>

퇴적물 조성비와 분급도 data를 함께 나타낼 경우는 polygon의 크기와 범례로
수치를 가시화 할수 있다.

``` r
#Plotting of Mud, Sand and Gravel texture and Add Sorting data
rysgran.ternary(x = data01[c(9, 6, 5)], method = "shepard",
                main = "Sed.Textural classifications(Garorim,2008)",
                z = data01$Sorting, z.cex.range = c(1,3),
                z.cex.labels = 22, z.cex.names = "Sorting",
                col = "blue", pch = 20,
                show.grid = TRUE,, show.legend = FALSE, 
                show.lines = FALSE, show.names = FALSE)

legend.bubbles ("topright", z=data01$Sorting , nleg=4, pch=20, col="blue",cex=1, 
  z.cex.range=c(1,3), x.intersp=1.2, y.intersp=1.2, digits=1, title="Sorting")
```

![rysgran\_04\_diagram](G:\R\Triangular%20diagram\rysgran\rysgran_04_diagram_sorting.png)

Gravel이 포함된 퇴적물에서의 분급도가 Snad나 Mud로만 이루어진 퇴적물보다
분급도가 크게 나타남을 알 수 있다.
