# src

@app.route('/git_hook', methods=['POST', 'GET'])
def from_git():
    print('git hook called !!')
    data = request.get_json()
    print(data['before'])
    print(data['after'])
    print(data['head_commit']['added'])
    print(data['head_commit']['removed'])
    print(data['head_commit']['modified'])

    for added in data['head_commit']['added']:  
        markdown = get_markdown(added)        
        row = Blogs(user_id=1, github_id=added, title=added, contents=markdown)
        db.session.add(row)

    for removed in data['head_commit']['removed']:        
        row = db.session.query(Blogs).filter_by(github_id=removed).first()
        if not row: continue
        db.session.delete(row)

    db.session.commit()

    for modified in data['head_commit']['modified']:        
        row = db.session.query(Blogs).filter_by(github_id=modified).first()
        if not row: continue
        row.contents = get_markdown(modified)        
        db.session.commit()    

    resp = jsonify(success=True)
    return resp
    
    
    
